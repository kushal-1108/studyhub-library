<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Study Hub Library ‚Äî Registration</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Syne:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #f5c518;
            --gold-light: #ffe066;
            --gold-dim: #b8960f;
            --gold-glow: rgba(245, 197, 24, 0.25);
            --black: #0a0a0a;
            --black-card: #111111;
            --black-soft: #1a1a1a;
            --black-border: #2a2a2a;
            --white: #f0f0f0;
            --white-dim: #888888;
            --error: #ff4d4d;
            --success: #00e676;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            height: 100%;
            overflow: hidden;
            font-family: 'Outfit', sans-serif;
            background: var(--black);
            color: var(--white);
        }

        #bgCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .grain-overlay {
            position: fixed; inset: 0; z-index: 1; pointer-events: none; opacity: 0.035;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            background-size: 128px;
        }

        .glow-orb {
            position: fixed; border-radius: 50%; filter: blur(80px); z-index: 0;
            pointer-events: none; animation: orbFloat 12s ease-in-out infinite alternate;
        }
        .glow-orb.orb1 {
            width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(245,197,24,0.12), transparent 70%);
            top: -100px; left: -100px;
        }
        .glow-orb.orb2 {
            width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(245,197,24,0.08), transparent 70%);
            bottom: -80px; right: -80px; animation-delay: -6s;
        }
        @keyframes orbFloat {
            0% { transform: translate(0,0) scale(1); }
            100% { transform: translate(40px,30px) scale(1.15); }
        }

        /* ============ TOP BAR ============ */
        .topbar {
            position: fixed; top: 0; left: 0; right: 0; z-index: 100;
            padding: 16px 28px;
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(10,10,10,0.7); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--black-border);
        }
        .topbar-brand { display: flex; align-items: center; }
        .topbar-name { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 17px; letter-spacing: 0.5px; }
        .topbar-name span { color: var(--gold); }

        .progress-dots { display: flex; gap: 6px; align-items: center; }
        .dot {
            width: 8px; height: 8px; border-radius: 50%; background: var(--black-border);
            transition: all 0.5s cubic-bezier(0.4,0,0.2,1);
        }
        .dot.active { background: var(--gold); box-shadow: 0 0 10px var(--gold-glow); width: 28px; border-radius: 4px; }
        .dot.done { background: var(--gold-dim); }
        .step-counter { font-size: 12px; color: var(--white-dim); font-weight: 500; letter-spacing: 1px; min-width: 52px; text-align: right; }

        /* ============ FORM ============ */
        .form-wrapper {
            position: relative; z-index: 10; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            padding: 80px 24px 24px;
        }

        .slide {
            position: absolute; width: 100%; max-width: 580px; padding: 0 24px;
            opacity: 0; transform: translateY(60px) scale(0.95);
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.4,0,0.2,1);
        }
        .slide.active { opacity: 1; transform: translateY(0) scale(1); pointer-events: all; }
        .slide.exit-up { opacity: 0; transform: translateY(-80px) scale(0.95); }

        /* Scrollable slide for terms */
        .slide.scrollable {
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--gold-dim) transparent;
        }
        .slide.scrollable::-webkit-scrollbar { width: 5px; }
        .slide.scrollable::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 3px; }

        .q-tag {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(245,197,24,0.1); border: 1px solid rgba(245,197,24,0.2);
            border-radius: 20px; padding: 6px 14px;
            font-size: 12px; font-weight: 600; color: var(--gold);
            letter-spacing: 1px; text-transform: uppercase; margin-bottom: 20px;
        }

        .q-title {
            font-family: 'Syne', sans-serif; font-size: clamp(26px,5vw,42px); font-weight: 800;
            line-height: 1.15; margin-bottom: 8px;
            background: linear-gradient(135deg, var(--white) 60%, var(--gold-light));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }

        .q-subtitle { font-size: 15px; color: var(--white-dim); margin-bottom: 32px; line-height: 1.5; }

        /* ============ INPUTS ============ */
        .input-field {
            width: 100%; padding: 18px 22px;
            background: var(--black-soft); border: 2px solid var(--black-border); border-radius: 16px;
            color: var(--white); font-family: 'Outfit', sans-serif; font-size: 18px; font-weight: 500;
            outline: none; transition: all 0.35s ease; caret-color: var(--gold);
        }
        .input-field::placeholder { color: #444; font-weight: 400; }
        .input-field:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 5px rgba(245,197,24,0.08), 0 0 30px rgba(245,197,24,0.05);
            background: #0f0f0f;
        }
        textarea.input-field { resize: none; min-height: 100px; }
        .field-error { color: var(--error); font-size: 13px; font-weight: 500; margin-top: 10px; display: none; gap: 6px; }
        .field-error.visible { display: flex; }

        /* ============ DATE PICKER ============ */
        .date-picker-container { display: flex; gap: 12px; }
        .date-col { flex: 1; }
        .date-col label { display: block; font-size: 11px; color: var(--white-dim); text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; margin-bottom: 8px; }
        .date-select {
            width: 100%; padding: 16px 14px;
            background: var(--black-soft); border: 2px solid var(--black-border); border-radius: 14px;
            color: var(--white); font-family: 'Outfit', sans-serif; font-size: 17px; font-weight: 600;
            text-align: center; appearance: none; -webkit-appearance: none; cursor: pointer; outline: none;
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23888' stroke-width='2' fill='none'/%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 14px center;
        }
        .date-select:focus { border-color: var(--gold); box-shadow: 0 0 0 4px rgba(245,197,24,0.08); }
        .date-select option { background: var(--black-card); color: var(--white); }

        /* ============ SHIFT CARDS ============ */
        .shift-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }
        .shift-card {
            background: var(--black-soft); border: 2px solid var(--black-border); border-radius: 20px;
            padding: 24px 14px; text-align: center; cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4,0,0.2,1); position: relative; overflow: hidden;
        }
        .shift-card::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(245,197,24,0.06), transparent);
            opacity: 0; transition: opacity 0.4s;
        }
        .shift-card:hover { border-color: #444; transform: translateY(-4px); }
        .shift-card:hover::before { opacity: 1; }
        .shift-card.selected {
            border-color: var(--gold); background: rgba(245,197,24,0.05);
            box-shadow: 0 0 0 4px rgba(245,197,24,0.1), 0 8px 32px rgba(245,197,24,0.08);
        }
        .shift-card.selected::before { opacity: 1; }
        .shift-icon { font-size: 40px; margin-bottom: 12px; }
        .shift-card h3 { font-family: 'Syne', sans-serif; font-size: 17px; font-weight: 700; }
        .shift-card p { font-size: 13px; color: var(--white-dim); margin-top: 4px; }
        .shift-badge {
            position: absolute; top: 14px; right: 14px; width: 26px; height: 26px;
            border-radius: 50%; background: var(--gold); display: none;
            align-items: center; justify-content: center; font-size: 14px; font-weight: 800; color: var(--black);
            animation: badgePop 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
        }
        .shift-card.selected .shift-badge { display: flex; }
        @keyframes badgePop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* ============ UPLOAD ============ */
        .upload-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        .upload-area {
            border: 2px dashed var(--black-border); border-radius: 20px; padding: 36px 24px;
            text-align: center; cursor: pointer; transition: all 0.4s ease;
            position: relative; overflow: hidden; background: var(--black-soft);
        }
        .upload-area:hover { border-color: var(--gold-dim); background: rgba(245,197,24,0.02); }
        .upload-area.uploaded { border-style: solid; border-color: var(--success); background: rgba(0,230,118,0.03); }
        .upload-area input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; z-index: 2; }
        .upload-icon { font-size: 42px; margin-bottom: 10px; }
        .upload-area h4 { font-size: 16px; font-weight: 600; }
        .upload-area p { font-size: 13px; color: var(--white-dim); margin-top: 4px; }
        .upload-thumb { margin-top: 14px; }
        .upload-thumb img { max-width: 140px; max-height: 90px; border-radius: 10px; border: 2px solid var(--black-border); }
        .upload-thumb .fname { font-size: 12px; color: var(--success); font-weight: 600; margin-top: 6px; }

        /* ============ CAMERA ‚Äî SQUARE CAPTURE + CIRCLE PREVIEW ============ */
        .camera-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .camera-ring {
            width: 260px;
            height: 260px;
            border-radius: 50%;
            padding: 5px;
            background: conic-gradient(var(--gold), var(--gold-dim), var(--gold-light), var(--gold));
            animation: ringRotate 4s linear infinite;
            position: relative;
        }

        .camera-ring.captured {
            animation: none;
            background: var(--success);
        }

        @keyframes ringRotate {
            to { background: conic-gradient(from 360deg, var(--gold), var(--gold-dim), var(--gold-light), var(--gold)); }
        }

        /* Rotating ring using pseudo-element */
        .camera-ring::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--gold);
            animation: spinRing 2s linear infinite;
        }

        .camera-ring.captured::before {
            border-top-color: var(--success);
            animation: none;
        }

        @keyframes spinRing {
            to { transform: rotate(360deg); }
        }

        .camera-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            background: #000;
            position: relative;
        }

        .camera-inner video {
            width: 260px;
            height: 260px;
            object-fit: cover;
            display: block;
        }

        .camera-inner canvas {
            width: 260px;
            height: 260px;
            object-fit: cover;
            display: none;
        }

        /* Square hidden canvas for actual capture */
        #captureCanvas {
            display: none;
        }

        .cam-label {
            font-size: 13px;
            color: var(--white-dim);
            text-align: center;
        }

        .cam-btn-row {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .cam-btn {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            padding: 14px 32px; border: none; border-radius: 50px;
            font-family: 'Outfit', sans-serif; font-weight: 700; font-size: 15px;
            cursor: pointer; transition: all 0.3s ease;
        }
        .cam-btn.capture { background: var(--gold); color: var(--black); }
        .cam-btn.capture:hover { box-shadow: 0 0 25px var(--gold-glow); transform: scale(1.05); }
        .cam-btn.retake { background: var(--black-border); color: var(--white); }
        .cam-btn.retake:hover { background: #3a3a3a; }

        .cam-success {
            text-align: center; font-size: 15px; color: var(--success); font-weight: 600;
            display: none; align-items: center; gap: 6px; justify-content: center;
        }

        .cam-success.visible { display: flex; }

        /* Mirror toggle */
        .mirror-toggle {
            display: flex;
            gap: 4px;
            background: var(--black-soft);
            border: 1px solid var(--black-border);
            border-radius: 12px;
            padding: 4px;
        }

        .mirror-btn {
            padding: 8px 18px;
            border: none;
            border-radius: 9px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: var(--white-dim);
        }

        .mirror-btn.active {
            background: var(--gold);
            color: var(--black);
        }

        .mirror-btn:not(.active):hover {
            color: var(--white);
            background: rgba(255,255,255,0.05);
        }

        .camera-inner.mirrored video {
            transform: scaleX(-1);
        }

        /* ============ TERMS ============ */
        .terms-scroll {
            background: var(--black-soft); border: 1px solid var(--black-border);
            border-radius: 16px; padding: 22px; max-height: 320px; overflow-y: auto;
            font-size: 13.5px; line-height: 1.75; color: var(--white-dim); margin-bottom: 20px;
            scrollbar-width: thin; scrollbar-color: var(--gold-dim) var(--black-soft);
        }
        .terms-scroll::-webkit-scrollbar { width: 6px; }
        .terms-scroll::-webkit-scrollbar-track { background: var(--black-soft); }
        .terms-scroll::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 3px; }
        .terms-scroll h4 { color: var(--gold); font-family: 'Syne', sans-serif; margin-bottom: 12px; font-size: 15px; }

        .rule-item {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(42,42,42,0.5);
            align-items: flex-start;
        }
        .rule-item:last-child { border-bottom: none; }
        .rule-emoji { font-size: 18px; flex-shrink: 0; margin-top: 1px; }
        .rule-text strong { color: var(--gold); }
        .rule-text { font-size: 13px; line-height: 1.6; }

        .check-row { display: flex; align-items: flex-start; gap: 12px; cursor: pointer; }
        .custom-check {
            width: 24px; height: 24px; border: 2px solid var(--black-border); border-radius: 8px;
            flex-shrink: 0; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease; margin-top: 2px; cursor: pointer;
        }
        .custom-check.checked { background: var(--gold); border-color: var(--gold); }
        .custom-check.checked::after { content: '‚úì'; color: var(--black); font-weight: 800; font-size: 14px; }
        .check-row span { font-size: 14px; color: var(--white-dim); line-height: 1.45; }
        .check-row span strong { color: var(--gold); }

        /* ============ BUTTONS ============ */
        .nav-row { display: flex; align-items: center; justify-content: space-between; margin-top: 36px; }
        .btn-next {
            display: inline-flex; align-items: center; gap: 10px;
            padding: 16px 36px; background: var(--gold); color: var(--black);
            border: none; border-radius: 14px; font-family: 'Outfit', sans-serif;
            font-weight: 700; font-size: 16px; cursor: pointer;
            transition: all 0.35s cubic-bezier(0.4,0,0.2,1);
        }
        .btn-next:hover { box-shadow: 0 0 30px rgba(245,197,24,0.3), 0 6px 20px rgba(245,197,24,0.2); transform: translateY(-2px); }
        .btn-next:active { transform: translateY(0) scale(0.98); }
        .btn-next .arr { font-size: 18px; transition: transform 0.3s; }
        .btn-next:hover .arr { transform: translateX(4px); }

        .btn-back {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 14px 24px; background: transparent; color: var(--white-dim);
            border: 2px solid var(--black-border); border-radius: 14px;
            font-family: 'Outfit', sans-serif; font-weight: 600; font-size: 14px;
            cursor: pointer; transition: all 0.3s ease;
        }
        .btn-back:hover { border-color: #555; color: var(--white); }

        .btn-submit {
            display: inline-flex; align-items: center; gap: 10px;
            padding: 16px 36px; background: var(--gold); color: var(--black);
            border: none; border-radius: 14px; font-family: 'Outfit', sans-serif;
            font-weight: 700; font-size: 16px; cursor: pointer;
            transition: all 0.35s cubic-bezier(0.4,0,0.2,1);
        }
        .btn-submit:hover { box-shadow: 0 0 30px rgba(245,197,24,0.3), 0 6px 20px rgba(245,197,24,0.2); transform: translateY(-2px); }

        .key-hint { margin-top: 16px; font-size: 12px; color: #444; display: flex; align-items: center; gap: 6px; }
        .key-hint kbd { background: var(--black-border); padding: 3px 8px; border-radius: 5px; font-size: 11px; font-weight: 600; color: var(--white-dim); border: 1px solid #333; }

        /* ============ THANK YOU ============ */
        .thankyou-wrap { text-align: center; }
        .ty-icon {
            width: 100px; height: 100px; margin: 0 auto 24px;
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 50px; animation: tyPop 0.7s cubic-bezier(0.175,0.885,0.32,1.275);
            box-shadow: 0 0 60px rgba(245,197,24,0.3);
        }
        @keyframes tyPop { 0% { transform: scale(0) rotate(-20deg); opacity: 0; } 100% { transform: scale(1) rotate(0); opacity: 1; } }
        .ty-title {
            font-family: 'Syne', sans-serif; font-size: clamp(28px,5vw,40px); font-weight: 800;
            background: linear-gradient(135deg, var(--gold), var(--white));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            margin-bottom: 8px;
        }
        .ty-sub { color: var(--white-dim); font-size: 15px; line-height: 1.6; }

        .id-card {
            background: linear-gradient(135deg, var(--black-soft), #1e1e1e);
            border: 2px solid var(--gold); border-radius: 20px; padding: 28px;
            margin: 28px auto; max-width: 400px; position: relative; overflow: hidden;
        }
        .id-card::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: conic-gradient(from 0deg, transparent 0%, rgba(245,197,24,0.04) 25%, transparent 50%);
            animation: idSpin 8s linear infinite;
        }
        @keyframes idSpin { to { transform: rotate(360deg); } }
        .id-card-inner { position: relative; z-index: 2; }
        .id-label { font-size: 11px; text-transform: uppercase; letter-spacing: 3px; color: var(--white-dim); margin-bottom: 6px; }
        .id-value { font-family: 'Syne', sans-serif; font-size: 32px; font-weight: 800; color: var(--gold); letter-spacing: 3px; }

        .summary-grid {
            background: var(--black-soft); border: 1px solid var(--black-border);
            border-radius: 16px; padding: 20px; margin: 24px 0; text-align: left;
            max-height: 250px; overflow-y: auto; scrollbar-width: thin;
            scrollbar-color: var(--gold-dim) var(--black-soft);
        }
        .summary-grid::-webkit-scrollbar { width: 5px; }
        .summary-grid::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 3px; }
        .summary-grid h4 { font-family: 'Syne', sans-serif; color: var(--gold); margin-bottom: 14px; font-size: 15px; }
        .s-row { display: flex; justify-content: space-between; padding: 9px 0; border-bottom: 1px solid var(--black-border); font-size: 13px; }
        .s-row:last-child { border-bottom: none; }
        .s-row .s-label { color: var(--white-dim); }
        .s-row .s-val { color: var(--white); font-weight: 600; text-align: right; max-width: 58%; word-break: break-word; }

        /* ============ LOADING ============ */
        .loading-screen {
            display: none; position: fixed; inset: 0; z-index: 9999;
            background: rgba(10,10,10,0.92); backdrop-filter: blur(12px);
            flex-direction: column; align-items: center; justify-content: center;
        }
        .loading-screen.on { display: flex; }
        .loader-ring {
            width: 56px; height: 56px;
            border: 4px solid var(--black-border); border-top-color: var(--gold);
            border-radius: 50%; animation: spin 0.75s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-screen p { color: var(--white-dim); font-weight: 600; margin-top: 18px; }

        @keyframes shakeX {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-12px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-8px); }
            80% { transform: translateX(6px); }
        }

        @media (max-width: 480px) {
            .q-title { font-size: 24px; }
            .input-field { font-size: 16px; padding: 16px 18px; }
            .btn-next { padding: 14px 28px; font-size: 15px; }
            .topbar { padding: 12px 16px; justify-content: center; position: fixed; }
            .upload-row { grid-template-columns: 1fr; }
            .shift-grid { grid-template-columns: 1fr; }
            .progress-dots { display: none; }
            .step-counter { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); }
            .camera-ring { width: 220px; height: 220px; }
            .camera-inner video, .camera-inner canvas { width: 220px; height: 220px; }
        }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>
<div class="grain-overlay"></div>
<div class="glow-orb orb1"></div>
<div class="glow-orb orb2"></div>

<!-- Top Bar -->
<div class="topbar">
    <div class="topbar-brand">
        <div class="topbar-name">The Study <span>Hub</span></div>
    </div>
    <div class="progress-dots" id="progressDots"></div>
    <div class="step-counter" id="stepCounter">1 / 11</div>
</div>

<div class="form-wrapper">

    <!-- S1: Name -->
    <div class="slide active" id="s1">
        <div class="q-tag">‚Üí Let's Begin</div>
        <h1 class="q-title">What's your full name?</h1>
        <p class="q-subtitle">Enter your name as it appears on your Aadhaar card.</p>
        <input class="input-field" type="text" id="studentName" placeholder="e.g. Rahul Kumar Sharma" autocomplete="name" autofocus>
        <div class="field-error" id="err-studentName">‚ö† Please enter your full name</div>
        <div class="nav-row" style="justify-content:flex-end;">
            <button class="btn-next" onclick="goNext(1)">Continue <span class="arr">‚Üí</span></button>
        </div>
        <div class="key-hint"><kbd>Enter ‚Üµ</kbd> to continue</div>
    </div>

    <!-- S2: Father -->
    <div class="slide" id="s2">
        <div class="q-tag">‚Üí Family</div>
        <h1 class="q-title">Your father's name?</h1>
        <p class="q-subtitle">As per official records.</p>
        <input class="input-field" type="text" id="fatherName" placeholder="e.g. Rajesh Kumar Sharma">
        <div class="field-error" id="err-fatherName">‚ö† Please enter your father's name</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(2)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(2)">Continue <span class="arr">‚Üí</span></button>
        </div>
        <div class="key-hint"><kbd>Enter ‚Üµ</kbd> to continue</div>
    </div>

    <!-- S3: DOB -->
    <div class="slide" id="s3">
        <div class="q-tag">‚Üí Identity</div>
        <h1 class="q-title">When were you born?</h1>
        <p class="q-subtitle">Select your date of birth.</p>
        <div class="date-picker-container">
            <div class="date-col"><label>Day</label><select class="date-select" id="dobDay"></select></div>
            <div class="date-col"><label>Month</label><select class="date-select" id="dobMonth">
                <option value="">‚Äî</option><option value="01">Jan</option><option value="02">Feb</option><option value="03">Mar</option><option value="04">Apr</option><option value="05">May</option><option value="06">Jun</option><option value="07">Jul</option><option value="08">Aug</option><option value="09">Sep</option><option value="10">Oct</option><option value="11">Nov</option><option value="12">Dec</option>
            </select></div>
            <div class="date-col"><label>Year</label><select class="date-select" id="dobYear"></select></div>
        </div>
        <div class="field-error" id="err-dob">‚ö† Please select a complete date</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(3)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(3)">Continue <span class="arr">‚Üí</span></button>
        </div>
    </div>

    <!-- S4: Phone -->
    <div class="slide" id="s4">
        <div class="q-tag">‚Üí Contact</div>
        <h1 class="q-title">Your phone number?</h1>
        <p class="q-subtitle">We'll use this to reach you if needed.</p>
        <input class="input-field" type="tel" id="phone" placeholder="e.g. 9876543210" maxlength="10">
        <div class="field-error" id="err-phone">‚ö† Enter a valid 10-digit number</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(4)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(4)">Continue <span class="arr">‚Üí</span></button>
        </div>
        <div class="key-hint"><kbd>Enter ‚Üµ</kbd> to continue</div>
    </div>

    <!-- S5: Email -->
    <div class="slide" id="s5">
        <div class="q-tag">‚Üí Contact</div>
        <h1 class="q-title">Your email address?</h1>
        <p class="q-subtitle">A confirmation copy will be sent here.</p>
        <input class="input-field" type="email" id="email" placeholder="e.g. rahul@gmail.com">
        <div class="field-error" id="err-email">‚ö† Enter a valid email</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(5)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(5)">Continue <span class="arr">‚Üí</span></button>
        </div>
        <div class="key-hint"><kbd>Enter ‚Üµ</kbd> to continue</div>
    </div>

    <!-- S6: Shift -->
    <div class="slide" id="s6">
        <div class="q-tag">‚Üí Membership</div>
        <h1 class="q-title">Choose your shift</h1>
        <p class="q-subtitle">Pick the plan that works for you.</p>
        <div class="shift-grid">
            <div class="shift-card" onclick="pickShift('Half Day ‚Äî Morning (7 Hrs)', this)">
                <div class="shift-badge">‚úì</div>
                <div class="shift-icon">üåÖ</div>
                <h3>Half Day</h3>
                <p>Morning ¬∑ 7 Hrs</p>
            </div>
            <div class="shift-card" onclick="pickShift('Half Day ‚Äî Evening (7 Hrs)', this)">
                <div class="shift-badge">‚úì</div>
                <div class="shift-icon">üåá</div>
                <h3>Half Day</h3>
                <p>Evening ¬∑ 7 Hrs</p>
            </div>
            <div class="shift-card" onclick="pickShift('Full Day (15 Hrs)', this)">
                <div class="shift-badge">‚úì</div>
                <div class="shift-icon">üåô</div>
                <h3>Full Day</h3>
                <p>15 Hrs Access</p>
            </div>
        </div>
        <div class="field-error" id="err-shift">‚ö† Please select a shift</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(6)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(6)">Continue <span class="arr">‚Üí</span></button>
        </div>
    </div>

    <!-- S7: Seat Number -->
    <div class="slide" id="s7">
        <div class="q-tag">‚Üí Membership</div>
        <h1 class="q-title">Your allotted seat number?</h1>
        <p class="q-subtitle">Enter the seat number assigned to you by the library staff.</p>
        <input class="input-field" type="text" id="seatNumber" placeholder="e.g. A-12 or 25" maxlength="10">
        <div class="field-error" id="err-seatNumber">‚ö† Please enter your seat number</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(7)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(7)">Continue <span class="arr">‚Üí</span></button>
        </div>
        <div class="key-hint"><kbd>Enter ‚Üµ</kbd> to continue</div>
    </div>

    <!-- S8: Joining Date -->
    <div class="slide" id="s8">
        <div class="q-tag">‚Üí Membership</div>
        <h1 class="q-title">When do you start?</h1>
        <p class="q-subtitle">Select your joining date.</p>
        <div class="date-picker-container">
            <div class="date-col"><label>Day</label><select class="date-select" id="joinDay"></select></div>
            <div class="date-col"><label>Month</label><select class="date-select" id="joinMonth">
                <option value="">‚Äî</option><option value="01">Jan</option><option value="02">Feb</option><option value="03">Mar</option><option value="04">Apr</option><option value="05">May</option><option value="06">Jun</option><option value="07">Jul</option><option value="08">Aug</option><option value="09">Sep</option><option value="10">Oct</option><option value="11">Nov</option><option value="12">Dec</option>
            </select></div>
            <div class="date-col"><label>Year</label><select class="date-select" id="joinYear"></select></div>
        </div>
        <div class="field-error" id="err-join">‚ö† Please select a complete date</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(8)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(8)">Continue <span class="arr">‚Üí</span></button>
        </div>
    </div>

    <!-- S9: Aadhaar -->
    <div class="slide" id="s9">
        <div class="q-tag">‚Üí Documents</div>
        <h1 class="q-title">Upload Aadhaar card</h1>
        <p class="q-subtitle">Both front and back for verification.</p>
        <div class="upload-row">
            <div class="upload-area" id="zone-front">
                <input type="file" accept="image/*" onchange="handleUpload(this,'front')">
                <div class="upload-icon">üì∏</div>
                <h4>Front Side</h4>
                <p>Tap to upload</p>
                <div class="upload-thumb" id="thumb-front"></div>
            </div>
            <div class="upload-area" id="zone-back">
                <input type="file" accept="image/*" onchange="handleUpload(this,'back')">
                <div class="upload-icon">üì∏</div>
                <h4>Back Side</h4>
                <p>Tap to upload</p>
                <div class="upload-thumb" id="thumb-back"></div>
            </div>
        </div>
        <div class="field-error" id="err-aadhaar">‚ö† Please upload both sides</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(9)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(9)">Continue <span class="arr">‚Üí</span></button>
        </div>
    </div>

    <!-- S10: Purpose -->
    <div class="slide" id="s10">
        <div class="q-tag">‚Üí About You</div>
        <h1 class="q-title">Why are you joining?</h1>
        <p class="q-subtitle">Tell us ‚Äî exams, self-study, competitive prep?</p>
        <textarea class="input-field" id="purpose" placeholder="e.g. Preparing for UPSC Civil Services exam..."></textarea>
        <div class="field-error" id="err-purpose">‚ö† Please describe your purpose</div>
        <div class="nav-row">
            <button class="btn-back" onclick="goBack(10)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(10)">Continue <span class="arr">‚Üí</span></button>
        </div>
    </div>

    <!-- S11: Terms & Conditions (SEPARATE PAGE) -->
    <div class="slide scrollable" id="s11">
        <div class="q-tag">‚Üí Rules</div>
        <h1 class="q-title">Library rules</h1>
        <p class="q-subtitle">Please read and accept all rules before proceeding.</p>

        <div class="terms-scroll">
            <h4>üìú The Study Hub Library ‚Äî Terms & Conditions</h4>

            <div class="rule-item">
                <span class="rule-emoji">üíß</span>
                <div class="rule-text"><strong>Drinking Water</strong> ‚Äî Fresh drinking water is available in the dispenser.</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">‚ö†Ô∏è</span>
                <div class="rule-text"><strong>Hot Water Safety</strong> ‚Äî After taking hot water, please switch off the dispenser within 30 seconds to avoid overheating or damage. It may burn or overboil if left on.</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">üöª</span>
                <div class="rule-text"><strong>Washroom</strong> ‚Äî The washroom is clearly marked ‚Äî look for the door labeled "Washroom" in the library.</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">üö™</span>
                <div class="rule-text"><strong>Door Etiquette</strong> ‚Äî Please close all library doors fully and slowly. Avoid slamming or leaving them ajar.</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">üìû</span>
                <div class="rule-text"><strong>Need Help?</strong> ‚Äî For any assistance, query, or issue, feel free to call or message us anytime: <strong>7303599125</strong>. We're always available and happy to help!</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">üìù</span>
                <div class="rule-text"><strong>Daily Attendance</strong> ‚Äî Please ensure to mark your attendance daily, including: ‚úÖ First Entry Time ‚úÖ Last Exit Time. Write according to the Library Register instructions.</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">üí∞</span>
                <div class="rule-text"><strong>Timely Fee Submission</strong> ‚Äî Please ensure that advance fees are submitted on time, every month without delay.</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">üìÖ</span>
                <div class="rule-text"><strong>Monthly Fee Calculation</strong> ‚Äî The fee is calculated month-to-month, not on a per-day or per-visit basis. Please do not ask for fee deductions based on days missed (e.g., "I didn't come for 5 or 15 days, so reduce the fee").</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">üîí</span>
                <div class="rule-text"><strong>Property Rules</strong> ‚Äî Do not touch or tamper with any property of The Study Hub Library (CCTV, Wi-Fi, electricals, equipment) without prior permission.</div>
            </div>
            <div class="rule-item">
                <span class="rule-emoji">üôè</span>
                <div class="rule-text"><strong>Conclusion</strong> ‚Äî Once you join The Study Hub Library, you are required to pay the full monthly fee, regardless of your attendance. Let's maintain discipline, mutual respect, and a productive study environment together! Thank you for understanding.</div>
            </div>
        </div>

        <div class="check-row" onclick="toggleCheck()">
            <div class="custom-check" id="termsBox"></div>
            <span>I have read and agree to all <strong>Terms & Conditions</strong> of The Study Hub Library.</span>
        </div>
        <div class="field-error" id="err-terms">‚ö† You must accept the terms</div>

        <div class="nav-row">
            <button class="btn-back" onclick="goBack(11)">‚Üê Back</button>
            <button class="btn-next" onclick="goNext(11)">Continue <span class="arr">‚Üí</span></button>
        </div>
    </div>

    <!-- S12: Live Photo (DEDICATED PAGE ‚Äî smooth) -->
    <div class="slide" id="s12">
        <div class="q-tag">‚Üí Final Step</div>
        <h1 class="q-title">Take a selfie</h1>
        <p class="q-subtitle">A clear photo of your face for your library database.</p>

        <div class="camera-wrapper">
            <div class="camera-ring" id="cameraRing">
                <div class="camera-inner mirrored" id="cameraInner">
                    <video id="camVideo" autoplay playsinline muted></video>
                    <canvas id="camCanvas"></canvas>
                </div>
            </div>
            <!-- Hidden square canvas for actual image data -->
            <canvas id="captureCanvas"></canvas>

            <!-- Mirror / Natural Toggle -->
            <div class="mirror-toggle" id="mirrorToggle">
                <button class="mirror-btn active" id="btnMirror" onclick="setMirror(true)">ü™û Mirror</button>
                <button class="mirror-btn" id="btnNatural" onclick="setMirror(false)">üë§ Natural</button>
            </div>

            <p class="cam-label" id="camLabel">Position your face in the circle</p>
            <p class="cam-success" id="camSuccess">‚úÖ Photo captured successfully!</p>

            <div class="cam-btn-row">
                <button class="cam-btn capture" id="btnCapture" onclick="capturePhoto()">üì∏ Capture Photo</button>
                <button class="cam-btn retake" id="btnRetake" onclick="retakePhoto()" style="display:none;">üîÑ Retake</button>
            </div>
        </div>

        <div class="field-error" id="err-photo">‚ö† Please capture your live photo</div>

        <div class="nav-row" style="margin-top:28px;">
            <button class="btn-back" onclick="goBack(12)">‚Üê Back</button>
            <button class="btn-submit" onclick="submitForm()">üéì Submit Registration</button>
        </div>
    </div>

    <!-- S13: Thank You -->
    <div class="slide" id="s13">
        <div class="thankyou-wrap">
            <div class="ty-icon">üéâ</div>
            <h1 class="ty-title">You're In!</h1>
            <p class="ty-sub">Welcome to <strong style="color:var(--gold)">The Study Hub Library</strong>.<br>Your registration is confirmed.</p>
            <div class="id-card">
                <div class="id-card-inner">
                    <div class="id-label">Your Student ID</div>
                    <div class="id-value" id="showId">‚Äî</div>
                </div>
            </div>
            <p style="font-size:13px;color:var(--white-dim);">Confirmation sent to <strong style="color:var(--gold)" id="showEmail"></strong></p>
            <div class="summary-grid">
                <h4>üìã Registration Summary</h4>
                <div id="summaryRows"></div>
            </div>
            <p style="font-size:12px;color:#555;margin-top:12px;">Save your Student ID. Bring it on day one.</p>
        </div>
    </div>

</div>

<!-- Loading -->
<div class="loading-screen" id="loader">
    <div class="loader-ring"></div>
    <p>Submitting registration...</p>
</div>

<script>
// ====== PARTICLE BACKGROUND ======
(function() {
    const c = document.getElementById('bgCanvas');
    const ctx = c.getContext('2d');
    let particles = [], w, h;
    function resize() { w = c.width = innerWidth; h = c.height = innerHeight; }
    resize(); addEventListener('resize', resize);

    class P {
        constructor() { this.reset(); }
        reset() {
            this.x = Math.random() * w; this.y = Math.random() * h;
            this.vx = (Math.random() - 0.5) * 0.3; this.vy = (Math.random() - 0.5) * 0.3;
            this.r = Math.random() * 1.8 + 0.5;
            this.a = Math.random() * 0.3 + 0.05;
            this.g = Math.random() > 0.7;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if (this.x < -10 || this.x > w+10 || this.y < -10 || this.y > h+10) this.reset();
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
            ctx.fillStyle = this.g ? `rgba(245,197,24,${this.a})` : `rgba(255,255,255,${this.a*0.6})`;
            ctx.fill();
        }
    }

    for (let i = 0; i < 80; i++) particles.push(new P());

    function loop() {
        ctx.clearRect(0, 0, w, h);
        particles.forEach(p => { p.update(); p.draw(); });
        for (let i = 0; i < particles.length; i++) {
            for (let j = i+1; j < particles.length; j++) {
                const dx = particles[i].x - particles[j].x, dy = particles[i].y - particles[j].y;
                const d = Math.sqrt(dx*dx + dy*dy);
                if (d < 120) {
                    ctx.beginPath();
                    ctx.moveTo(particles[i].x, particles[i].y);
                    ctx.lineTo(particles[j].x, particles[j].y);
                    ctx.strokeStyle = `rgba(245,197,24,${0.04*(1-d/120)})`;
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                }
            }
        }
        requestAnimationFrame(loop);
    }
    loop();
})();

// ====== STATE ======
const TOTAL = 13;
let cur = 1, shiftVal = '', termsOk = false;
let files = { front: null, back: null, photo: null };
let camStream = null;

// ====== POPULATE DATES ======
(function() {
    const dd = document.getElementById('dobDay');
    dd.innerHTML = '<option value="">‚Äî</option>';
    for (let d = 1; d <= 31; d++) dd.innerHTML += `<option value="${String(d).padStart(2,'0')}">${d}</option>`;

    const dy = document.getElementById('dobYear');
    const mx = new Date().getFullYear() - 5;
    dy.innerHTML = '<option value="">‚Äî</option>';
    for (let y = mx; y >= 1970; y--) dy.innerHTML += `<option value="${y}">${y}</option>`;

    const jd = document.getElementById('joinDay');
    jd.innerHTML = '<option value="">‚Äî</option>';
    for (let d = 1; d <= 31; d++) jd.innerHTML += `<option value="${String(d).padStart(2,'0')}">${d}</option>`;

    const jy = document.getElementById('joinYear');
    const ty = new Date().getFullYear();
    jy.innerHTML = '<option value="">‚Äî</option>';
    for (let y = ty; y <= ty + 1; y++) jy.innerHTML += `<option value="${y}">${y}</option>`;

    const t = new Date();
    jd.value = String(t.getDate()).padStart(2, '0');
    document.getElementById('joinMonth').value = String(t.getMonth() + 1).padStart(2, '0');
    jy.value = String(t.getFullYear());
})();

// ====== PROGRESS ======
function buildDots() {
    const c = document.getElementById('progressDots');
    c.innerHTML = '';
    for (let i = 1; i <= TOTAL; i++) {
        const d = document.createElement('div');
        d.className = 'dot' + (i === cur ? ' active' : (i < cur ? ' done' : ''));
        c.appendChild(d);
    }
    document.getElementById('stepCounter').textContent = cur === TOTAL ? '‚úì Done' : `${cur} / ${TOTAL - 1}`;
}
buildDots();

// ====== NAVIGATION ======
function goTo(n) {
    if (n < 1 || n > TOTAL) return;
    const prev = document.getElementById('s' + cur);
    prev.classList.remove('active');
    prev.classList.add('exit-up');
    setTimeout(() => prev.classList.remove('exit-up'), 600);
    cur = n;
    document.getElementById('s' + cur).classList.add('active');
    buildDots();
    setTimeout(() => {
        const inp = document.getElementById('s' + cur).querySelector('input[type="text"],input[type="tel"],input[type="email"],textarea');
        if (inp) inp.focus();
    }, 400);
    // Start camera when entering photo step
    if (cur === 12 && !files.photo) {
        setTimeout(() => startCam(), 300);
    }
}

function goNext(f) { if (!validate(f)) return; goTo(f + 1); }
function goBack(f) {
    if (f === 12) stopCam();
    goTo(f - 1);
}

document.addEventListener('keydown', e => {
    if (e.key === 'Enter' && cur <= 10) {
        const ta = document.getElementById('s' + cur).querySelector('textarea');
        if (ta && document.activeElement === ta) return;
        e.preventDefault();
        goNext(cur);
    }
});

// ====== VALIDATION ======
function clrErr(id) { const e = document.getElementById('err-' + id); if (e) e.classList.remove('visible'); }
function shwErr(id) { const e = document.getElementById('err-' + id); if (e) e.classList.add('visible'); }

function shake(id) {
    const el = document.getElementById(id);
    el.style.animation = 'none';
    void el.offsetWidth;
    el.style.animation = 'shakeX 0.5s ease';
    setTimeout(() => el.style.animation = '', 500);
}

function validate(s) {
    ['studentName','fatherName','dob','phone','email','shift','seatNumber','join','aadhaar','purpose','terms','photo'].forEach(clrErr);
    if (s===1 && !document.getElementById('studentName').value.trim()) { shwErr('studentName'); shake('s1'); return false; }
    if (s===2 && !document.getElementById('fatherName').value.trim()) { shwErr('fatherName'); shake('s2'); return false; }
    if (s===3) {
        if (!document.getElementById('dobDay').value || !document.getElementById('dobMonth').value || !document.getElementById('dobYear').value) { shwErr('dob'); shake('s3'); return false; }
    }
    if (s===4 && !/^\d{10}$/.test(document.getElementById('phone').value.trim())) { shwErr('phone'); shake('s4'); return false; }
    if (s===5 && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(document.getElementById('email').value.trim())) { shwErr('email'); shake('s5'); return false; }
    if (s===6 && !shiftVal) { shwErr('shift'); shake('s6'); return false; }
    if (s===7 && !document.getElementById('seatNumber').value.trim()) { shwErr('seatNumber'); shake('s7'); return false; }
    if (s===8) {
        if (!document.getElementById('joinDay').value || !document.getElementById('joinMonth').value || !document.getElementById('joinYear').value) { shwErr('join'); shake('s8'); return false; }
    }
    if (s===9 && (!files.front || !files.back)) { shwErr('aadhaar'); shake('s9'); return false; }
    if (s===10 && !document.getElementById('purpose').value.trim()) { shwErr('purpose'); shake('s10'); return false; }
    if (s===11 && !termsOk) { shwErr('terms'); shake('s11'); return false; }
    return true;
}

// ====== SHIFT ======
function pickShift(v, el) {
    shiftVal = v;
    document.querySelectorAll('.shift-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
}

// ====== UPLOAD ======
function handleUpload(input, key) {
    const f = input.files[0];
    if (!f) return;
    if (f.size > 5*1024*1024) { alert('Max 5MB'); return; }
    const r = new FileReader();
    r.onload = e => {
        files[key] = e.target.result;
        document.getElementById('zone-' + key).classList.add('uploaded');
        document.getElementById('thumb-' + key).innerHTML = `<img src="${e.target.result}"><div class="fname">‚úÖ ${f.name}</div>`;
    };
    r.readAsDataURL(f);
}

// ====== TERMS ======
function toggleCheck() {
    termsOk = !termsOk;
    document.getElementById('termsBox').classList.toggle('checked', termsOk);
}

// ====== CAMERA (Smooth ‚Äî dedicated page) ======
let isMirrored = true;

function setMirror(mirror) {
    isMirrored = mirror;
    const inner = document.getElementById('cameraInner');
    document.getElementById('btnMirror').classList.toggle('active', mirror);
    document.getElementById('btnNatural').classList.toggle('active', !mirror);
    if (mirror) {
        inner.classList.add('mirrored');
    } else {
        inner.classList.remove('mirrored');
    }
}

async function startCam() {
    try {
        const v = document.getElementById('camVideo');
        stopCam();

        camStream = await navigator.mediaDevices.getUserMedia({
            video: {
                facingMode: 'user',
                width: { ideal: 480 },
                height: { ideal: 480 }
            },
            audio: false
        });
        v.srcObject = camStream;
        await v.play();

        v.style.display = 'block';
        document.getElementById('camCanvas').style.display = 'none';
        document.getElementById('btnCapture').style.display = 'flex';
        document.getElementById('btnRetake').style.display = 'none';
        document.getElementById('camSuccess').classList.remove('visible');
        document.getElementById('camLabel').style.display = 'block';
        document.getElementById('cameraRing').classList.remove('captured');
        document.getElementById('mirrorToggle').style.display = 'flex';

        // Apply current mirror setting
        setMirror(isMirrored);
    } catch (e) {
        console.error('Camera error:', e);
        alert('Camera access denied. Please allow camera permission and try again.');
    }
}

function stopCam() {
    if (camStream) {
        camStream.getTracks().forEach(t => t.stop());
        camStream = null;
    }
    const v = document.getElementById('camVideo');
    if (v.srcObject) {
        v.srcObject = null;
    }
}

function capturePhoto() {
    const v = document.getElementById('camVideo');
    const displayCanvas = document.getElementById('camCanvas');
    const captureCanvas = document.getElementById('captureCanvas');

    // Square capture at 480x480
    const size = Math.min(v.videoWidth, v.videoHeight);
    const sx = (v.videoWidth - size) / 2;
    const sy = (v.videoHeight - size) / 2;

    captureCanvas.width = 480;
    captureCanvas.height = 480;
    const captureCtx = captureCanvas.getContext('2d');

    if (isMirrored) {
        // Flip horizontally for mirror mode
        captureCtx.translate(480, 0);
        captureCtx.scale(-1, 1);
    }
    captureCtx.drawImage(v, sx, sy, size, size, 0, 0, 480, 480);
    captureCtx.setTransform(1, 0, 0, 1, 0, 0); // reset

    // Save square image data
    files.photo = captureCanvas.toDataURL('image/jpeg', 0.85);

    // Show in circle display canvas
    const ringSize = document.getElementById('cameraRing').offsetWidth - 10;
    displayCanvas.width = ringSize;
    displayCanvas.height = ringSize;
    displayCanvas.getContext('2d').drawImage(captureCanvas, 0, 0, 480, 480, 0, 0, ringSize, ringSize);

    v.style.display = 'none';
    displayCanvas.style.display = 'block';
    stopCam();

    document.getElementById('btnCapture').style.display = 'none';
    document.getElementById('btnRetake').style.display = 'flex';
    document.getElementById('camSuccess').classList.add('visible');
    document.getElementById('camLabel').style.display = 'none';
    document.getElementById('cameraRing').classList.add('captured');
    document.getElementById('mirrorToggle').style.display = 'none';
}

function retakePhoto() {
    files.photo = null;
    document.getElementById('camSuccess').classList.remove('visible');
    startCam();
}

// ====== HELPERS ======
function genId() {
    const n = new Date(), yr = n.getFullYear().toString().slice(-2), mn = (n.getMonth()+1).toString().padStart(2,'0');
    return `SHL-${yr}${mn}-${Math.floor(1000+Math.random()*9000)}`;
}

function fmtDate(d, m, y) {
    const mo = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    return `${d}-${mo[parseInt(m)-1]}-${y}`;
}

// ====== SUBMIT ======
async function submitForm() {
    clrErr('photo');
    if (!files.photo) { shwErr('photo'); shake('s12'); return; }
    stopCam();

    const id = genId();
    const dobStr = fmtDate(document.getElementById('dobDay').value, document.getElementById('dobMonth').value, document.getElementById('dobYear').value);
    const joinStr = fmtDate(document.getElementById('joinDay').value, document.getElementById('joinMonth').value, document.getElementById('joinYear').value);

    const data = {
        studentId: id,
        studentName: document.getElementById('studentName').value.trim(),
        fatherName: document.getElementById('fatherName').value.trim(),
        dob: dobStr,
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim(),
        joiningDate: joinStr,
        shift: shiftVal,
        seatNumber: document.getElementById('seatNumber').value.trim(),
        purpose: document.getElementById('purpose').value.trim(),
        aadhaarFront: files.front,
        aadhaarBack: files.back,
        livePhoto: files.photo,
        submittedAt: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
    };

    document.getElementById('loader').classList.add('on');

    try {
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyX07D8Jn730mBlcxner6mYd1EeqRBuZovb53SpVgtwmO0-74e7F7TuHVTVURwhO98B/exec';
        await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        showDone(data);
    } catch (e) { showDone(data); }
}

function showDone(d) {
    document.getElementById('loader').classList.remove('on');
    document.getElementById('showId').textContent = d.studentId;
    document.getElementById('showEmail').textContent = d.email;
    const rows = [['Student ID',d.studentId],['Name',d.studentName],["Father's Name",d.fatherName],['DOB',d.dob],['Phone',d.phone],['Email',d.email],['Shift',d.shift],['Seat No.',d.seatNumber],['Joining',d.joiningDate],['Purpose',d.purpose],['Submitted',d.submittedAt]];
    document.getElementById('summaryRows').innerHTML = rows.map(([l,v]) => `<div class="s-row"><span class="s-label">${l}</span><span class="s-val">${v}</span></div>`).join('');
    goTo(13);
}
</script>
</body>
</html>